<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>关于生活，关于前端 › Express入门</title>
  <meta name="author" content="Zhuxy">
  
  <meta name="description" content="此文为翻译，删改了一些东西。
1.Express安装
假设你对Node和npm已经有些熟悉，新建一个文件夹：node
1.1第一种方法：
首先在node文件夹里，我们新建package.json来配置Express应用的一些信息。
12345678{    &quot;name&quot;: &quot;demo1&quot;,    &quot;">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="Express入门"/>
  <meta property="og:site_name" content="关于生活，关于前端"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="关于生活，关于前端" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  
</head>


<body>
  <header id="header"><div class="meta inner">
  <h1><a href="/">关于生活，关于前端</a></h1>
  <h2 id="header-h2"></h2>
  <nav id="main-nav">
    <ul>
      
      <li><a href="/">首页</a></li>
      
      <li><a href="/archives">文章归档</a></li>
      
      <li><a href="/about">关于</a></li>
      
    </ul>
    <div class="clearfix"></div>
  </nav>
</div>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  <div class="post-content">
    <header>
      
  
    <h1 class="title">Express入门</h1>
  

      
      <time datetime="2014-11-01T12:41:46.000Z">Nov 1 2014</time>
      
    </header>
    <div class="entry">
      
        <p>此文为翻译，删改了一些东西。</p>
<p>1.Express安装</p>
<p>假设你对Node和npm已经有些熟悉，新建一个文件夹：node</p>
<p>1.1第一种方法：</p>
<p>首先在node文件夹里，我们新建<strong>package.json</strong>来配置Express应用的一些信息。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">{</div><div class="line">    "<span class="attribute">name</span>": <span class="value"><span class="string">"demo1"</span></span>,</div><div class="line">    "<span class="attribute">description</span>": <span class="value"><span class="string">"First Express app"</span></span>,</div><div class="line">    "<span class="attribute">version</span>": <span class="value"><span class="string">"0.0.1"</span></span>,</div><div class="line">    "<span class="attribute">dependencies</span>": <span class="value">{</span></div><div class="line">       "<span class="attribute">express</span>": <span class="value"><span class="string">"^4.10.1"</span></span>,</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>然后到终端里面输入：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm <span class="operator"><span class="keyword">install</span></span></div></pre></td></tr></table></figure>

<p>然后程序就会自动安装Express。</p>
<p>1.2第二种方法：</p>
<p>在终端cd node然后输入：</p>
<pre><code>npm <span class="keyword">init</span>
</code></pre><p>然后一路回车，最后输入<strong>yes</strong>，会自动生成<strong>package.json</strong>文件。</p>
<p>2.创建程序入口文件：app.js</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</div><div class="line"><span class="keyword">var</span> app = express();</div><div class="line">app.listen(<span class="number">3000</span>);</div></pre></td></tr></table></figure>

<p>在我学习一个新框架时，总会把节奏放的很慢，以至于不把问题变得很复杂。</p>
<p>3.定义程序的路由</p>
<p>现在让我们来给程序定义一些路由，Express通过API方法可以相应许多HTTP请求，请看下面例子：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Regular HTTP get</span></div><div class="line">app.<span class="keyword">get</span>(some url, <span class="keyword">do</span> something);</div><div class="line"> </div><div class="line"><span class="comment">//Some other page</span></div><div class="line">app.<span class="keyword">get</span>(some other url, <span class="keyword">do</span> something <span class="keyword">else</span>);</div><div class="line"> </div><div class="line"><span class="comment">//I can respond to a form post</span></div><div class="line">app.post(some url, <span class="keyword">do</span> more stuff);</div></pre></td></tr></table></figure>

<p>接下来我们添加一个真正的首页路由：</p>
<pre><code>app.<span class="keyword">get</span>(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span><span class="params">(request, response)</span> </span>{
    response.send(<span class="string">"This would be some HTML"</span>);
});    
</code></pre><p>注意现在我们在response上添加来一个send方法。如果到现在没有任何异常，你可以在终端输入<strong>node app.js</strong>来启动程序，并访问<a href="http://127.0.0.1:3000/" target="_blank" rel="external">http://127.0.0.1:3000/</a></p>
<p>此时在页面上你应该看到：</p>
<pre><code>This would <span class="keyword">be</span> some HTML
</code></pre><p>send方法可以处理不同数据类型的数据，假设你需要为你的站点添加JSON-based API，你可以简单的返回一个对象而不是字符串，Express可以自动把结果转换为JSON同时设置正确的相应头部：</p>
<pre><code>app.<span class="keyword">get</span>(<span class="string">'/api'</span>, <span class="function"><span class="keyword">function</span><span class="params">(request, response)</span> </span>{
    response.send({name:<span class="string">"Raymond"</span>,age:<span class="number">40</span>});
});
</code></pre><p>3.生成一个blog程序</p>
<p>我们的第一个程序是一个blog，它看起来没有什么但是应该有的基本知识都包含了。package.json保持原样不做修改，修改app.js如下：</p>
<pre><code><span class="keyword">var</span> express = require(<span class="string">'express'</span>);
<span class="keyword">var</span> app = express();

app.<span class="keyword">get</span>(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span> </span>{
    res.sendfile(<span class="string">'./views/index.html'</span>);
});

app.<span class="keyword">get</span>(<span class="string">'/about'</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span> </span>{
    res.sendfile(<span class="string">'./views/about.html'</span>);
});

app.<span class="keyword">get</span>(<span class="string">'/article'</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span> </span>{
    res.sendfile(<span class="string">'./views/article.html'</span>);
});

app.listen(<span class="number">3000</span>);
</code></pre><p>此时我们把send方法改为sendfile，并且在app.js里面引入了html。同时添加了首页，关于和文章页面。</p>
<p>接着我们在项目根目录添加views文件夹，并添加index.html,about.html和artical.html。index.html里面添加：</p>
<pre><code><span class="tag">&lt;<span class="title">html</span>&gt;</span>
<span class="tag">&lt;<span class="title">head</span>&gt;</span>
    <span class="tag">&lt;<span class="title">title</span>&gt;</span>Home Page<span class="tag">&lt;/<span class="title">title</span>&gt;</span>
<span class="tag">&lt;/<span class="title">head</span>&gt;</span>

<span class="tag">&lt;<span class="title">body</span>&gt;</span>
<span class="tag">&lt;<span class="title">h1</span>&gt;</span>Blog!<span class="tag">&lt;/<span class="title">h1</span>&gt;</span>

<span class="tag">&lt;<span class="title">footer</span>&gt;</span>
<span class="tag">&lt;<span class="title">p</span>&gt;</span>
    <span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"/"</span>&gt;</span>Home<span class="tag">&lt;/<span class="title">a</span>&gt;</span> ~ <span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"/about"</span>&gt;</span>About Me<span class="tag">&lt;/<span class="title">a</span>&gt;</span> ~ <span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"/article"</span>&gt;</span>Some Article<span class="tag">&lt;/<span class="title">a</span>&gt;</span>
<span class="tag">&lt;/<span class="title">p</span>&gt;</span>
<span class="tag">&lt;/<span class="title">footer</span>&gt;</span>

<span class="tag">&lt;/<span class="title">body</span>&gt;</span>
<span class="tag">&lt;/<span class="title">html</span>&gt;</span>
</code></pre><p>到目前为止并没有什么特别的，就是一些静态文件。终端里面终止程序，然后再启动程序访问首页应该看到上面写的一些东西。</p>
<p>4.改为动态应用</p>
<p>Express支持很多模版引擎（Jade，EJS……），但是我很喜欢Hanlebars所以在接下来的程序中选择了它。在我们的package.json里面添加：</p>
<pre><code>{
    "<span class="attribute">name</span>": <span class="value"><span class="string">"blog2"</span></span>,
    "<span class="attribute">description</span>": <span class="value"><span class="string">"Blog app"</span></span>,
    "<span class="attribute">version</span>": <span class="value"><span class="string">"0.0.1"</span></span>,
    "<span class="attribute">dependencies</span>": <span class="value">{
        "<span class="attribute">express</span>": <span class="value"><span class="string">"3.x"</span></span>,
        "<span class="attribute">hbs</span>":<span class="value"><span class="string">"*"</span>
    </span>}
</span>}
</code></pre><p>接下来我们需要在app.js中使用它：</p>
<pre><code><span class="keyword">var</span> express = require(<span class="string">'express'</span>);
<span class="keyword">var</span> app = express();

<span class="keyword">var</span> hbs = require(<span class="string">'hbs'</span>);

app.<span class="keyword">set</span>(<span class="string">'view engine'</span>, <span class="string">'html'</span>);
app.engine(<span class="string">'html'</span>, hbs.__express);

app.<span class="keyword">get</span>(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span> </span>{
    res.render(<span class="string">'index'</span>);
});

app.<span class="keyword">get</span>(<span class="string">'/about'</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span> </span>{
    res.render(<span class="string">'about'</span>);
});

app.<span class="keyword">get</span>(<span class="string">'/article'</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span> </span>{
    res.render(<span class="string">'article'</span>);
});

app.listen(<span class="number">3000</span>);
</code></pre><p>通过“view engine”告诉Express使用HTML作为动态文件，但这并不是必须的。“app.engine”才是指定何种引擎来渲染页面的。最后我们使用了render方法Express默认去views文件夹去加载页面文件，同时也会忽略文件后缀名，所以<strong>res.render(‘something’)</strong>等同于<strong>views/something.html</strong>，然后根据我们设置的模版引擎来渲染页面。</p>
<p>4.首页展示文章</p>
<p>为了保持教程简单这里并没有使用数据库，但是我们会模拟一些数据。在项目根目录创建：blog.js</p>
<pre><code><span class="keyword">var</span> entries = [
{<span class="string">"id"</span>:<span class="number">1</span>, <span class="string">"title"</span>:<span class="string">"Hello World!"</span>, <span class="string">"body"</span>:<span class="string">"This is the body of my blog entry. Sooo exciting."</span>, <span class="string">"published"</span>:<span class="string">"6/2/2013"</span>},
{<span class="string">"id"</span>:<span class="number">2</span>, <span class="string">"title"</span>:<span class="string">"Eggs for Breakfast"</span>, <span class="string">"body"</span>:<span class="string">"Today I had eggs for breakfast. Sooo exciting."</span>, <span class="string">"published"</span>:<span class="string">"6/3/2013"</span>},
{<span class="string">"id"</span>:<span class="number">3</span>, <span class="string">"title"</span>:<span class="string">"Beer is Good"</span>, <span class="string">"body"</span>:<span class="string">"News Flash! Beer is awesome!"</span>, <span class="string">"published"</span>:<span class="string">"6/4/2013"</span>},
{<span class="string">"id"</span>:<span class="number">4</span>, <span class="string">"title"</span>:<span class="string">"Mean People Suck"</span>, <span class="string">"body"</span>:<span class="string">"People who are mean aren't nice or fun to hang around."</span>, <span class="string">"published"</span>:<span class="string">"6/5/2013"</span>},
{<span class="string">"id"</span>:<span class="number">5</span>, <span class="string">"title"</span>:<span class="string">"I'm Leaving Technology X and You Care"</span>, <span class="string">"body"</span>:<span class="string">"Let me write some link bait about why I'm not using a particular technology anymore."</span>, <span class="string">"published"</span>:<span class="string">"6/10/2013"</span>},
{<span class="string">"id"</span>:<span class="number">6</span>, <span class="string">"title"</span>:<span class="string">"Help My Kickstarter"</span>, <span class="string">"body"</span>:<span class="string">"I want a new XBox One. Please fund my Kickstarter."</span>, <span class="string">"published"</span>:<span class="string">"6/12/2013"</span>}];


exports.getBlogEntries = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{
    <span class="keyword">return</span> entries;
}

exports.getBlogEntry = <span class="function"><span class="keyword">function</span><span class="params">(id)</span> </span>{
    <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i &lt; entries.length; i++) {
        <span class="keyword">if</span>(entries[i].id == id) <span class="keyword">return</span> entries[i];
    }
}
</code></pre><p>一贯的我们应该有一些：添加／编辑／删除的方法，但是到现在这两个方法足够了。更新app.js如下：</p>
<pre><code><span class="keyword">var</span> express = require(<span class="string">'express'</span>);
<span class="keyword">var</span> app = express();

<span class="keyword">var</span> hbs = require(<span class="string">'hbs'</span>);

<span class="keyword">var</span> blogEngine = require(<span class="string">'./blog'</span>);

app.<span class="keyword">set</span>(<span class="string">'view engine'</span>, <span class="string">'html'</span>);
app.engine(<span class="string">'html'</span>, hbs.__express);
app.<span class="keyword">use</span>(express.bodyParser());

app.<span class="keyword">get</span>(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span> </span>{
    res.render(<span class="string">'index'</span>,{title:<span class="string">"My Blog"</span>, entries:blogEngine.getBlogEntries()});
});

app.<span class="keyword">get</span>(<span class="string">'/about'</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span> </span>{
    res.render(<span class="string">'about'</span>, {title:<span class="string">"About Me"</span>});
});

app.<span class="keyword">get</span>(<span class="string">'/article/:id'</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span> </span>{
    <span class="keyword">var</span> entry = blogEngine.getBlogEntry(req.params.id);
    res.render(<span class="string">'article'</span>,{title:entry.title, blog:entry});
});

app.listen(<span class="number">3000</span>);
</code></pre><p>注意__以上方法使用于Express3.0，要是Express4.0则要把：</p>
<pre><code>app.<span class="keyword">use</span>(express.bodyParser());
</code></pre><p>换为：</p>
<pre><code><span class="keyword">var</span> bodyParser = <span class="keyword">require</span>(<span class="string">'body-parser'</span>);
app.<span class="keyword">use</span>(bodyParser.json());
app.<span class="keyword">use</span>(bodyParser.urlencoded({
  extended: <span class="keyword">true</span>
}));
</code></pre><p>接着我们要修改首页的代码，语法要根据你选择的模版引擎：(可能是hexo也编译大括号,所以我使用＋＋代替了大括号,大家如果复制代码记得改为大括号)</p>
<pre><code>&lt;<span class="comment">h1</span>&gt;<span class="comment">Blog!</span>&lt;<span class="comment">/h1</span>&gt;
<span class="literal">+</span><span class="literal">+</span><span class="comment">#each</span> <span class="comment">entries</span><span class="literal">+</span><span class="literal">+</span>
    &lt;<span class="comment">p</span>&gt;
        &lt;<span class="comment">a</span> <span class="comment">href="/article/</span><span class="literal">+</span><span class="literal">+</span><span class="comment">id</span><span class="literal">+</span><span class="literal">+</span><span class="comment">"</span>&gt;<span class="literal">+</span><span class="literal">+</span><span class="comment">title</span><span class="literal">+</span><span class="literal">+</span>&lt;<span class="comment">/a</span>&gt;&lt;<span class="comment">br/</span>&gt;
        <span class="comment">Published:</span> <span class="literal">+</span><span class="literal">+</span><span class="comment">published</span><span class="literal">+</span><span class="literal">+</span>
    &lt;<span class="comment">/p</span>&gt;
<span class="literal">+</span><span class="literal">+</span><span class="comment">/each</span><span class="literal">+</span><span class="literal">+</span>
</code></pre><p>即使你对Hanlebars不熟悉，也应该对上面的代码猜的差不多，就是循环文章列表。</p>
<p>5.添加页面框架</p>
<p>我敢说你现在应该疑惑其他页面结构去哪里了，当你在Express中使用模版引擎时会自动有框架支持。意味着我可以把我站点通用的东西整合到框架中同时Express会自动的在特定的地方输出我们的内容。在views里面创建layout.html:</p>
<pre><code><span class="tag">&lt;<span class="title">html</span>&gt;</span>
<span class="tag">&lt;<span class="title">head</span>&gt;</span>
    <span class="tag">&lt;<span class="title">title</span>&gt;</span>++title++<span class="tag">&lt;/<span class="title">title</span>&gt;</span>
<span class="tag">&lt;/<span class="title">head</span>&gt;</span>
<span class="tag">&lt;<span class="title">body</span>&gt;</span>
    +++body+++
    <span class="tag">&lt;<span class="title">footer</span>&gt;</span>
        <span class="tag">&lt;<span class="title">p</span>&gt;</span>
            <span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"/"</span>&gt;</span>Home<span class="tag">&lt;/<span class="title">a</span>&gt;</span> ~ <span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"/about"</span>&gt;</span>About Me<span class="tag">&lt;/<span class="title">a</span>&gt;</span>
        <span class="tag">&lt;/<span class="title">p</span>&gt;</span>
    <span class="tag">&lt;/<span class="title">footer</span>&gt;</span>
<span class="tag">&lt;/<span class="title">body</span>&gt;</span>
<span class="tag">&lt;/<span class="title">html</span>&gt;</span>
</code></pre><p>6.显示文章内容</p>
<p>更新artical.html:</p>
<pre><code>&lt;<span class="comment">h1</span>&gt;<span class="literal">+</span><span class="literal">+</span><span class="comment">blog</span><span class="string">.</span><span class="comment">title</span><span class="literal">+</span><span class="literal">+</span>&lt;<span class="comment">/h1</span>&gt;
&lt;<span class="comment">p</span>&gt;
    <span class="comment">Published:</span> <span class="literal">+</span><span class="literal">+</span><span class="comment">blog</span><span class="string">.</span><span class="comment">published</span><span class="literal">+</span><span class="literal">+</span>
&lt;<span class="comment">p/</span>&gt;
<span class="literal">+</span><span class="literal">+</span><span class="comment">blog</span><span class="string">.</span><span class="comment">body</span><span class="literal">+</span><span class="literal">+</span>
</code></pre><p>到此我们已经构建完成了我们的应用，重启应用：node app.js。</p>
<p>如果看不到文章列表或者报错：</p>
<pre><code><span class="keyword">module</span>.js:<span class="number">340</span>
    <span class="keyword">throw</span> err;
          ^
<span class="keyword">Error</span>: Cannot find <span class="keyword">module</span> <span class="comment">'/Users/zhuxy/work/node/views/app.js'</span>
    at <span class="keyword">Function</span>.<span class="keyword">Module</span>._resolveFilename (<span class="keyword">module</span>.js:<span class="number">338</span>:<span class="number">15</span>)
    at <span class="keyword">Function</span>.<span class="keyword">Module</span>._load (<span class="keyword">module</span>.js:<span class="number">280</span>:<span class="number">25</span>)
    at <span class="keyword">Function</span>.<span class="keyword">Module</span>.runMain (<span class="keyword">module</span>.js:<span class="number">497</span>:<span class="number">10</span>)
    at startup (node.js:<span class="number">119</span>:<span class="number">16</span>)
    at node.js:<span class="number">906</span>:<span class="number">3</span>
</code></pre><p>问题时没有找到<strong>node_path</strong>路径，在终端输入：</p>
<pre><code><span class="attribute">Linux(Mac)</span>: <span class="string">export NODE_PATH=../node_modules</span>
<span class="attribute">Windows</span>: <span class="string">set NODE_PATH=.</span>
</code></pre><p>我的是：</p>
<pre><code>export <span class="constant">NODE_PATH</span>=<span class="regexp">/usr/local</span><span class="regexp">/lib/node</span>_modules
</code></pre><p>到此我们的教程就完了！如有问题请回复 － －</p>
<p>原文：<a href="http://code.tutsplus.com/tutorials/introduction-to-express--net-33367" target="_blank" rel="external">http://code.tutsplus.com/tutorials/introduction-to-express--net-33367</a></p>

      
    </div>
    
    <footer>
      <div class="alignleft">
      
      
  
  <div class="tags">
    <a href="/tags/Express/">Express</a>
  </div>

      </div>
      <div class="clearfix"></div>
    </footer>
    
  </div>
</article>


<section id="comment">
  
            <!-- Duoshuo Comment BEGIN -->
            <div class="ds-thread"></div>
            <script type="text/javascript">
                var duoshuoQuery = {short_name:"zhuxinyong"};
                (function() {
                    var ds = document.createElement('script');
                    ds.type = 'text/javascript';ds.async = true;
                    ds.src = 'http://static.duoshuo.com/embed.js';
                    ds.charset = 'UTF-8';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
                })();
            </script>
            <!-- Duoshuo Comment END -->
      
  
</section>

</div></div>
    <div class="clearfix"></div>
  </div>
  <footer id="footer"><div class="inner"><div class="alignleft">
  <p>
  
    &copy; 2014 Zhuxy
  
  </p>
  <p>
    Based on <a href="https://github.com/willerce/hexo-theme-noderce" >Noderce</a>
  </p>

</div>
<div class="clearfix"></div></div></footer>
  <script type="text/javascript">

</script>

</body>
</html>
