<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>关于生活，关于前端 › Karma和Jasmine</title>
  <meta name="author" content="Zhuxy">
  
  <meta name="description" content="什么是Karma?
Karma是Google出品，前身叫“Testacular”，主要目的：
The main goal for Karma is to bring a productive testing environment to developers.
背景：
We found that we were struggling with existing tools, so we decided to write
our own test runner. We wanted a test runner that would meet all of our needs 
for both quick development and continuous integration -- a truly spectacular test runner. We&#39;ve called it Testacular.
大意：
为了满足我们（google）自己的测试运行器，满足快速开发和持续集成的需求。
什么是Jasmine?
Jasmine is a behavior-driven development framework for testing JavaScript code.
It does not depend on any other JavaScript frameworks. It does not require a DOM. 
And it has a clean, obvious syntax so that you can easily write tests.
类似的框架：Mocha、QUnit。">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="Karma和Jasmine"/>
  <meta property="og:site_name" content="关于生活，关于前端"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="关于生活，关于前端" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  
</head>


<body>
  <header id="header"><div class="meta inner">
  <h1><a href="/">关于生活，关于前端</a></h1>
  <h2 id="header-h2"></h2>
  <nav id="main-nav">
    <ul>
      
      <li><a href="/">首页</a></li>
      
      <li><a href="/archives">文章归档</a></li>
      
      <li><a href="/about">关于</a></li>
      
    </ul>
    <div class="clearfix"></div>
  </nav>
</div>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  <div class="post-content">
    <header>
      
  
    <h1 class="title">Karma和Jasmine</h1>
  

      
      <time datetime="2014-08-20T02:28:44.000Z">Aug 20 2014</time>
      
    </header>
    <div class="entry">
      
        <h3 id="什么是Karma?">什么是Karma?</h3>
<p>Karma是Google出品，前身叫“Testacular”，主要目的：</p>
<pre><code>The main goal <span class="keyword">for</span> Karma <span class="keyword">is</span> <span class="keyword">to</span> bring <span class="keyword">a</span> productive testing environment <span class="keyword">to</span> developers.
</code></pre><p>背景：</p>
<pre><code>We found <span class="keyword">that</span> we were struggling <span class="keyword">with</span> existing tools, so we decided <span class="keyword">to</span> <span class="command">write</span>
our own test runner. We wanted a test runner <span class="keyword">that</span> would meet all <span class="keyword">of</span> our needs 
<span class="keyword">for</span> both quick development <span class="keyword">and</span> continuous integration <span class="comment">-- a truly spectacular test runner. We've called it Testacular.</span>
</code></pre><p>大意：</p>
<pre><code>为了满足我们（google）自己的测试运行器，满足快速开发和持续集成的需求。
</code></pre><h3 id="什么是Jasmine?">什么是Jasmine?</h3>
<pre><code>Jasmine <span class="keyword">is</span> a behavior-driven development framework <span class="keyword">for</span> testing JavaScript code.
It <span class="keyword">does</span> <span class="keyword">not</span> depend <span class="function_start"><span class="keyword">on</span></span> any other JavaScript frameworks. It <span class="keyword">does</span> <span class="keyword">not</span> require a DOM. 
And <span class="keyword">it</span> has a clean, obvious syntax so <span class="keyword">that</span> you can easily <span class="command">write</span> tests.
</code></pre><p>类似的框架：Mocha、QUnit。</p>
<a id="more"></a>

<p>实例：（该实例基于node,请先安装。）</p>
<p>1). 新建项目文件夹：</p>
<pre><code><span class="built_in">mkdir</span> karma &amp;&amp;　<span class="keyword">cd</span> karma
</code></pre><p>2). 安装Karma</p>
<pre><code>npm <span class="operator"><span class="keyword">install</span> -g karma</span>
</code></pre><p>3). 运行karma</p>
<pre><code>karma <span class="operator"><span class="keyword">start</span></span>
</code></pre><p>得到下面类似信息：</p>
<pre><code>INFO [karma]: Karma v0.10.2 server started at http://localhost:9876/INFO 
[<span class="link_reference">Chrome 28.0.1500 (Windows 7)</span>]:<span class="link_url"> Connected on socket nIlM1yUy6ELMp5ZTN9Ek</span>
</code></pre><p>4). karma+Jasmine配置</p>
<pre><code>karma <span class="keyword">init</span>
</code></pre><p>接着会看到许多选择信息</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">Which testing framework <span class="keyword">do</span> you want <span class="keyword">to</span> use ?</div><div class="line">Press <span class="keyword">tab</span> <span class="keyword">to</span> <span class="keyword">list</span> possible <span class="keyword">options</span>. Enter <span class="keyword">to</span> <span class="keyword">move</span> <span class="keyword">to</span> the <span class="keyword">next</span> question.</div><div class="line">&gt; jasmine</div><div class="line"></div><div class="line">Do you want <span class="keyword">to</span> use Require.js ?</div><div class="line">This will <span class="built_in">add</span> Require.js plugin.</div><div class="line">Press <span class="keyword">tab</span> <span class="keyword">to</span> <span class="keyword">list</span> possible <span class="keyword">options</span>. Enter <span class="keyword">to</span> <span class="keyword">move</span> <span class="keyword">to</span> the <span class="keyword">next</span> question.</div><div class="line">&gt; <span class="keyword">no</span></div><div class="line"></div><div class="line">Do you want <span class="keyword">to</span> capture <span class="keyword">a</span> browser automatically ?</div><div class="line">Press <span class="keyword">tab</span> <span class="keyword">to</span> <span class="keyword">list</span> possible <span class="keyword">options</span>. Enter <span class="built_in">empty</span> <span class="built_in">string</span> <span class="keyword">to</span> <span class="keyword">move</span> <span class="keyword">to</span> the <span class="keyword">next</span> question.</div><div class="line">&gt; Chrome</div><div class="line">&gt;</div><div class="line"></div><div class="line">What <span class="keyword">is</span> the location of your <span class="keyword">source</span> <span class="built_in">and</span> test <span class="keyword">files</span> ?</div><div class="line">You can use <span class="built_in">glob</span> patterns, eg. <span class="string">"js/*.js"</span> <span class="built_in">or</span> <span class="string">"test/**/*Spec.js"</span>.</div><div class="line">Enter <span class="built_in">empty</span> <span class="built_in">string</span> <span class="keyword">to</span> <span class="keyword">move</span> <span class="keyword">to</span> the <span class="keyword">next</span> question.</div><div class="line">&gt;</div><div class="line"></div><div class="line">Should any of the <span class="keyword">files</span> included by the <span class="keyword">previous</span> patterns <span class="keyword">be</span> excluded ?</div><div class="line">You can use <span class="built_in">glob</span> patterns, eg. <span class="string">"**/*.swp"</span>.</div><div class="line">Enter <span class="built_in">empty</span> <span class="built_in">string</span> <span class="keyword">to</span> <span class="keyword">move</span> <span class="keyword">to</span> the <span class="keyword">next</span> question.</div><div class="line">&gt;</div><div class="line"></div><div class="line">Do you want Karma <span class="keyword">to</span> watch <span class="keyword">all</span> the <span class="keyword">files</span> <span class="built_in">and</span> run the tests <span class="keyword">on</span> <span class="keyword">change</span> ?</div><div class="line">Press <span class="keyword">tab</span> <span class="keyword">to</span> <span class="keyword">list</span> possible <span class="keyword">options</span>.</div><div class="line">&gt; yes</div><div class="line"></div><div class="line">Config <span class="keyword">file</span> generated at <span class="string">"F:\workspace\karma\karma.conf.js"</span>.</div></pre></td></tr></table></figure>

<p>5). 安装karma-jasmine集成包：</p>
<pre><code>npm <span class="operator"><span class="keyword">install</span> karma-jasmine</span>
</code></pre><p>6). 安装karma-chrome-launcher（注意如果上面要测试的浏览器还有别的，其余的也要安装）</p>
<pre><code>npm <span class="operator"><span class="keyword">install</span> karma-chrome-launcher <span class="comment">--save-dev</span></span>
</code></pre><p><strong>开始测试，需求：实现单词倒写功能：“ABCD”=&gt;“CDBA”</strong></p>
<p>1). 新建文件 src.js：</p>
<pre><code><span class="function"><span class="keyword">function</span> <span class="title">reverse</span><span class="params">(name)</span>{</span>
    <span class="keyword">return</span> name.<span class="built_in">split</span>(<span class="string">""</span>).<span class="built_in">reverse</span>().<span class="built_in">join</span>(<span class="string">""</span>);
}
</code></pre><p>2). 测试文件 test.js</p>
<pre><code>describe(<span class="string">"A suite of basic functions"</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{
    it(<span class="string">"reverse word"</span>,<span class="function"><span class="keyword">function</span><span class="params">()</span></span>{
        expect(<span class="string">"DCBA"</span>).toEqual(reverse(<span class="string">"ABCD"</span>));
    });
});
</code></pre><p>3). 修改配置karma.conf.js</p>
<pre><code><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> <span class="params">(config)</span> </span>{
    config.set({
        basePath: <span class="string">''</span>,
        frameworks: [<span class="string">'jasmine'</span>],
        files: [<span class="string">'*.js'</span>],
        exclude: [<span class="string">'karma.conf.js'</span>],
        reporters: [<span class="string">'progress'</span>],
        port: <span class="number">9876</span>,
        colors: <span class="literal">true</span>,
        logLevel: config.LOG_INFO,
        autoWatch: <span class="literal">true</span>,
        browsers: [<span class="string">'Chrome'</span>],
        captureTimeout: <span class="number">60000</span>,
        singleRun: <span class="literal">false</span>
    });
};
</code></pre><p>4). 运行karma</p>
<pre><code>karma start karma.<span class="keyword">conf</span>.js
</code></pre><p>得到如下类似信息：</p>
<pre><code>INFO [karma]: Karma v0<span class="number">.12</span><span class="number">.22</span> server started <span class="keyword">at</span> <span class="keyword">http</span>://localhost:<span class="number">9876</span>/
INFO [launcher]: Starting browser Chrome
INFO [Chrome <span class="number">36.0</span><span class="number">.1985</span> (Windows <span class="number">7</span>)]: Connected <span class="command"><span class="keyword">on</span> <span class="title">socket</span> <span class="title">lJRdB1wQiahW6-7IpqoI</span> <span class="title">wi</span></span>
th id <span class="number">82373062</span>
Chrome <span class="number">36.0</span><span class="number">.1985</span> (Windows <span class="number">7</span>): Executed <span class="number">1</span> <span class="operator">of</span> <span class="number">1</span> SUCCESS (<span class="number">0.01</span> <span class="built_in">secs</span> / <span class="number">0.002</span> <span class="built_in">secs</span>)
</code></pre><ol>
<li>修改test.js</li>
</ol>
<pre><code>describe(<span class="string">"A suite of basic functions"</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{
    it(<span class="string">"reverse word"</span>,<span class="function"><span class="keyword">function</span><span class="params">()</span></span>{
        expect(<span class="string">"DCBA"</span>).toEqual(reverse(<span class="string">"ABCD"</span>));
        expect(<span class="string">"Conan"</span>).toEqual(reverse(<span class="string">"nano"</span>));
    });
});
</code></pre><p>此时会得到错误：</p>
<pre><code>INFO [karma]: Karma v0<span class="number">.12</span><span class="number">.22</span> server started <span class="keyword">at</span> <span class="keyword">http</span>://localhost:<span class="number">9876</span>/
INFO [launcher]: Starting browser Chrome
INFO [Chrome <span class="number">36.0</span><span class="number">.1985</span> (Windows <span class="number">7</span>)]: Connected <span class="command"><span class="keyword">on</span> <span class="title">socket</span> <span class="title">Kta8N3MgRiMy4FLyp82H</span> <span class="title">wi</span></span>
th id <span class="number">72338317</span>
Chrome <span class="number">36.0</span><span class="number">.1985</span> (Windows <span class="number">7</span>) A suite <span class="operator">of</span> basic <span class="function"><span class="keyword">function</span> <span class="title">reverse</span> <span class="title">word</span> <span class="title">FAILED</span></span>
        Expected <span class="string">'Conan'</span> <span class="built_in">to</span> equal <span class="string">'onan'</span>.
        Error: Expected <span class="string">'Conan'</span> <span class="built_in">to</span> equal <span class="string">'onan'</span>.
            <span class="keyword">at</span> Object.&lt;anonymous&gt; (F:/wordspace/karma/test.js:<span class="number">8</span>:<span class="number">19</span>)
Chrome <span class="number">36.0</span><span class="number">.1985</span> (Windows <span class="number">7</span>): Executed <span class="number">1</span> <span class="operator">of</span> <span class="number">1</span> (<span class="number">1</span> FAILED) ERROR (<span class="number">0.015</span> <span class="built_in">secs</span> / <span class="number">0.0</span>
<span class="number">04</span> <span class="built_in">secs</span>)
</code></pre><p>这错误是正常的。</p>
<p>参考：</p>
<ol>
<li><a href="http://googletesting.blogspot.jp/2012/11/testacular-spectacular-test-runner-for.html" target="_blank" rel="external">http://googletesting.blogspot.jp/2012/11/testacular-spectacular-test-runner-for.html</a></li>
<li><a href="http://blog.fens.me/nodejs-karma-jasmine/" target="_blank" rel="external">http://blog.fens.me/nodejs-karma-jasmine/</a></li>
<li><a href="https://egghead.io/lessons/unit-testing-introduction-to-karma" target="_blank" rel="external">https://egghead.io/lessons/unit-testing-introduction-to-karma</a></li>
<li><a href="http://www.slideshare.net/IgorNapierala/jasmine-presentation-23905530?next_slideshow=1（翻墙）" target="_blank" rel="external">http://www.slideshare.net/IgorNapierala/jasmine-presentation-23905530?next_slideshow=1（翻墙）</a></li>
<li><a href="http://blog.segmentfault.com/bornkiller/1190000000623274" target="_blank" rel="external">http://blog.segmentfault.com/bornkiller/1190000000623274</a></li>
</ol>

      
    </div>
    
    <footer>
      <div class="alignleft">
      
      
      </div>
      <div class="clearfix"></div>
    </footer>
    
  </div>
</article>


<section id="comment">
  
            <!-- Duoshuo Comment BEGIN -->
            <div class="ds-thread"></div>
            <script type="text/javascript">
                var duoshuoQuery = {short_name:"zhuxinyong"};
                (function() {
                    var ds = document.createElement('script');
                    ds.type = 'text/javascript';ds.async = true;
                    ds.src = 'http://static.duoshuo.com/embed.js';
                    ds.charset = 'UTF-8';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
                })();
            </script>
            <!-- Duoshuo Comment END -->
      
  
</section>

</div></div>
    <div class="clearfix"></div>
  </div>
  <footer id="footer"><div class="inner"><div class="alignleft">
  <p>
  
    &copy; 2014 Zhuxy
  
  </p>
  <p>
    Based on <a href="https://github.com/willerce/hexo-theme-noderce" >Noderce</a>
  </p>

</div>
<div class="clearfix"></div></div></footer>
  <script type="text/javascript">

</script>

</body>
</html>
